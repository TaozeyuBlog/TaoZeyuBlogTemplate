<%  var currentPage = parseInt(params);

    var pages = R.dir("/articles").allPages();
    if (session.node) {
        pages = pages.filter({node : session.node});
    }
%>

<div class="details">

    <%  var pagesParams = {
            currentPage : currentPage,
            className : "mdl-button mdl-js-button",
            hrefGenerator : function(page) {
                if (page == 0 && !session.node) {
                    return "/";
                } else {
                    var arr = [];
                    if (session.node) {
                        arr.push("nodes", session.node);
                    }
                    arr.push("page", page);
                    return "/"+ arr.join("/")+ ".html";
                }
            },
        };
    %>
    
    <div class="mdl-card mdl-cell mdl-cell--12-col mdl-shadow--2dp">

    <% if(!session.hideNodeTitle) { 
        var nodes = R.config("/nodes");
        var nodeName = "全部文章";
        for (var key in nodes) {
            if (nodes[key] == session.node) {
                nodeName = key;
                break;
            }
        }
    %>
        <div class="mdl-card__supporting-text">
            <h4><%= nodeName %> <a href="/" class="mdl-button" style="float:right;">返回首页</a></h4>
    	</div>
        <HR/>
    <% } %>
    
    <% for each(var page in pages.subArrayOnPage(pagesParams)) { %>
        <div class="mdl-card__supporting-text">
        	<h4><%= page.get("title") %></h4>
			<%= page.getAbstractContent() %>
    	</div>
        <div class="mdl-card__actions">
            <a href="<%= page.getPath() %>.html" class="mdl-button">阅读这篇文章</a>
    	</div>
        <HR/>
	<% } %>
        <nav class="pages mdl-navigation"><% pages.pagesConstructor(pagesParams); %></nav>
	</div>
</div>
